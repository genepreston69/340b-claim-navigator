-- Create contract_pharmacies table
CREATE TABLE public.contract_pharmacies (
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  pharmacy_name VARCHAR NOT NULL,
  address_1 VARCHAR,
  address_2 VARCHAR,
  address_3 VARCHAR,
  city VARCHAR,
  state VARCHAR(2),
  zip VARCHAR(10),
  contract_id INTEGER,
  contract_begin_date DATE,
  contract_approval_date DATE,
  contract_term_date DATE,
  pharmacy_id INTEGER,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()
);

-- Enable RLS
ALTER TABLE public.contract_pharmacies ENABLE ROW LEVEL SECURITY;

-- All authenticated users can view
CREATE POLICY "Authenticated users can view contract_pharmacies"
ON public.contract_pharmacies
FOR SELECT
USING (auth.uid() IS NOT NULL);

-- Only admins can modify
CREATE POLICY "Admins can manage contract_pharmacies"
ON public.contract_pharmacies
FOR ALL
USING (has_role(auth.uid(), 'admin'::app_role))
WITH CHECK (has_role(auth.uid(), 'admin'::app_role));

-- Create timestamp trigger
CREATE TRIGGER update_contract_pharmacies_updated_at
BEFORE UPDATE ON public.contract_pharmacies
FOR EACH ROW
EXECUTE FUNCTION public.update_updated_at_column();

-- Insert the contract pharmacy data
INSERT INTO public.contract_pharmacies (pharmacy_name, address_1, address_2, address_3, city, state, zip, contract_id, contract_begin_date, contract_approval_date, contract_term_date, pharmacy_id) VALUES
('HURLEY DRUG COMPANY INC', 'HURLEY DRUG COMPANY INC', '210 LOGAN ST', NULL, 'WILLIAMSON', 'WV', '25661', 83695, '2017-04-01', '2017-01-31', NULL, 30436),
('WAL-MART PHARMACY 10-2548', '28402 U.S. HWY 119 NO.', NULL, NULL, 'SO WILLIAMSON', 'KY', '41503', 93484, '2018-04-01', '2018-01-16', NULL, 47846),
('MCNAMEE INC', 'DBA FAMILY PHARMACY', '412 CENTRAL AVE', NULL, 'SOUTH WILLIAMSON', 'KY', '41503', 93485, '2018-04-01', '2018-01-16', NULL, 101112),
('KENTUCKY CVS PHARMACY, L.L.C.', 'DBA: CVS/PHARMACY  # 06340', '197 APPALACHIAN PLAZA', NULL, 'SOUTH WILLIAMSON', 'KY', '41503', 93486, '2018-04-01', '2018-01-16', NULL, 47845),
('FOOD CITY PHARMACY #425', '28093 THOMPSON PLAZA', 'PO BOX 2719', NULL, 'SOUTH WILLIAMSON', 'KY', '41503', 93488, '2018-04-01', '2018-01-16', NULL, 47844),
('WILLIAMSON PHARMACY', '54 W 2ND AVE', NULL, NULL, 'WILLIAMSON', 'WV', '25661', 121187, '2019-07-01', '2019-04-09', NULL, 118267),
('WAL-MART PHARMACY 10-5997', '9600 PARKSOUTH CT. SUITE 100', NULL, NULL, 'ORLANDO', 'FL', '32837', 193886, '2021-01-01', '2020-10-18', NULL, 39270),
('WAL-MART CENTRAL FILL 10-2670', '608 SPRING HILL DR # 3 SUITE 300', NULL, NULL, 'SPRING', 'TX', '77386', 193889, '2021-01-01', '2020-10-18', NULL, 70688),
('TOTAL PHARMACY CARE OF BELFRY', '20 STATE HIGHWAY 319', NULL, NULL, 'BELFRY', 'KY', '41514', 195373, '2020-12-31', '2020-12-14', NULL, 47847),
('EXPRESS SCRIPTS', 'ESI MAIL PHARMACY SERVICE INC', '4600 N HANLEY RD', NULL, 'SAINT LOUIS', 'MO', '63134', 196588, '2021-01-28', '2021-01-11', NULL, 61609),
('EXPRESS SCRIPTS PHARMACY, INC.', 'DBA EXPRESS SCRIPTS', '2040 ROUTE 130 NORTH', NULL, 'BURLINGTON', 'NJ', '08016', 196592, '2021-01-28', '2021-01-11', NULL, 92471),
('EXPRESS SCRIPTS PHARMACY, INC.', 'DBA EXPRESS SCRIPTS', '4750 E. 450 S.', NULL, 'WHITESTOWN', 'IN', '46075', 196595, '2021-01-28', '2021-01-11', NULL, 90880),
('ESI MAIL PHARMACY SERVICE', 'DBA EXPRESS SCRIPTS', '7909 S HARDY DR STE 106', NULL, 'TEMPE', 'AZ', '85284', 196597, '2021-01-28', '2021-01-11', NULL, 75670),
('MEDICINE CABINET PHARMACY', '50 LINCOLN STREET', 'PO BOX 600', NULL, 'KERMIT', 'WV', '25674', 255549, '2022-07-01', '2022-06-25', NULL, 133039),
('CAREMARK TENNESSEE SPECIALTY PHARMACY, L', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '8370 WOLF LAKE DR', 'STE 107', 'BARTLETT', 'TN', '38133', 305807, '2023-10-01', '2023-06-19', NULL, 45962),
('CAREMARK FLORIDA SPECIALTY PHARMACY LLC', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '7930 WOODLAND CENTER BLVD STE 500', NULL, 'TAMPA', 'FL', '33614', 305808, '2023-10-01', '2023-06-19', NULL, 41487),
('CAREMARK, L.L.C.', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '7251 S. EASTERN AVE.', NULL, 'LAS VEGAS', 'NV', '89119', 305809, '2023-10-01', '2023-06-19', NULL, 125644),
('CAREMARK, L.L.C.', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '1127 BRYN MAWR AVE', 'SUITE A', 'REDLANDS', 'CA', '92374', 305810, '2023-10-01', '2023-06-19', NULL, 612),
('CAREMARK ILLINOIS SPECIALTY PHARMACY, LL', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '800 BIERMANN CT STE B', NULL, 'MOUNT PROSPECT', 'IL', '60056', 305811, '2023-10-01', '2023-06-19', NULL, 59113),
('CAREMARK KANSAS SPECIALTY PHARMACY', 'CVS/SPECIALTY OR CARELONRX SPECIALTY PHA', '11162 RENNER BLVD', NULL, 'LENEXA', 'KS', '66219', 305812, '2023-10-01', '2023-06-19', NULL, 62899),
('PROCARE PHARMACY, L.L.C.', 'DBA  CVS/PHARMACY  #2923', '3250 HARDEN ST. EXT. SUITE #300', NULL, 'COLUMBIA', 'SC', '29203', 305813, '2023-10-01', '2023-06-19', NULL, 34053),
('CAREMARK MASSACHUSETTS SPECIALTY PHARMAC', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '25 BIRCH STREET, BLDG B, SUITE 100', NULL, 'MILFORD', 'MA', '01757', 305814, '2023-10-01', '2023-06-19', NULL, 13653),
('CAREMARK NORTH CAROLINA SPECIALTY PHARMA', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '10700 WORLD TRADE BLVD STE 110', NULL, 'RALEIGH', 'NC', '27617', 305815, '2023-10-01', '2023-06-19', NULL, 31787),
('CVS/SPECIALTY OR CARELONRX SPECIALTY PHA', 'CAREMARK, LLC', '1001 SPINKS ROAD, STE 280', NULL, 'FLOWER MOUND', 'TX', '75028', 305816, '2023-10-01', '2023-06-19', NULL, 111796),
('PROCARE PHARMACY DIRECT, L.L.C.', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '105 MALL BOULEVARD', NULL, 'MONROEVILLE', 'PA', '15146', 305817, '2023-10-01', '2023-06-19', NULL, 2289),
('CAREMARK NEW JERSEY SPECIALTY PHCY, LLC', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '180 PASSAIC AVE UNIT B-5', NULL, 'FAIRFIELD', 'NJ', '07004', 305818, '2023-10-01', '2023-06-19', NULL, 16293),
('CAREMARK MICHIGAN SPECIALTY PHARMACY, LL', 'DBA CVS/SPECIALTY OR CARELONRX SPECIALTY', '1307 ALLEN DR STE H', NULL, 'TROY', 'MI', '48083', 305819, '2023-10-01', '2023-06-19', NULL, 53118),
('PROCARE PHARMACY, L.L.C.', 'DBA: CVS/PHARMACY #2909', '1521 4TH AVE., SOUTH', NULL, 'BIRMINGHAM', 'AL', '35233', 305820, '2023-10-01', '2023-06-19', NULL, 43566),
('WALMART PHARMACY 10-5169', '2252 NORTH 8TH STREET', NULL, 'SUITE A', 'ROGERS', 'AR', '72756', 322789, '2024-01-01', '2023-10-07', NULL, 66076),
('Walmart Pharmacy 10-7611', '2501 Perry Rd', NULL, NULL, 'Plainfield', 'IN', '46168', 322791, '2024-01-01', '2023-10-07', NULL, 140224),
('CVS CAREMARK', 'DBA CVS/CAREMARK OR CF# 11506', '1 GREAT VALLEY BLVD', NULL, 'WILKES BARRE', 'PA', '18706', 344384, '2024-07-01', '2024-05-17', NULL, 25050),
('CVS CAREMARK ADVANCED TECHNOLOGY PHARMAC', 'DBA CVS/CAREMARK 48067', '1780 WALL ST', NULL, 'MT PROSPECT', 'IL', '60056', 344385, '2024-07-01', '2024-05-17', NULL, 59114);